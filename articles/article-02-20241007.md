---
title: "【IRON CTF】Write Ups"
emoji: "🐈"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["CTF"]
published: false
---

# はじめに
2024年の10月5日から10月6日にわたって24時間で開催された[IRON CTF](https://ctf.1nf1n1ty.team/)のWrite up です．

![](/images/02/ironctf_result.png =250x)

1671ptで，169位でした．

# Write ups
## Dantig's Puzzle - Crypto
### 問題文
> Dantzig was on a trip with his friends and one day, they decided to play a game or atleast, it's easier version. He would think of a string and the others have to find it based on the clues he gives them.
>
> 1. The knapsack list contains 8 numbers, with 1 and 2 as the first two numbers and the subsequent numbers are formed by adding one to the sum of all the numbers before.
> 2. The value of m=257 and n is something less than 257
> 3. The encrypted string is - [538, 619, 944, 831, 360, 531, 468, 971, 635, 593, 655, 425, 1068, 530, 1068, 360, 706, 1068, 299, 619, 670, 1068, 891, 425, 670, 1068, 371, 670, 732, 531, 1068, 484, 372, 635, 371, 372, 237, 237, 1007]
>
> Can you find the string Dantzig was thinking of?
>
> Flag Format: ironCTF{this_is_fake}
> Author: p3rplex3d

### 解法
「Dantzig」，「Knapsack」などの単語でググると「ナップザック暗号」が関連しているとわかります．

https://ja.wikipedia.org/wiki/Merkle-Hellman%E3%83%8A%E3%83%83%E3%83%97%E3%82%B5%E3%83%83%E3%82%AF%E6%9A%97%E5%8F%B7

復号には公開鍵である$\beta$と共通鍵である$w, q, r$が必要と分かります．

wikiの記述と問題文を照らし合わせると

* $n(=8)$ビットのデータの列を暗号化している
* 「Knapsack list」が超増加列$w$
* 秘密鍵$q = 257$ (問題文中の$m$)

であると推測できます．

秘密鍵である$r$が与えられていません．しかし，$\mathrm{gcd}(q, r)=1$という制約から，$r$の候補は256通りしかないとわかります．このため，$r$のすべての候補について復号を試みればよいです．また，公開鍵である$\beta$は$r$と超増加列$w$から計算できます．

これを実装します．

````python
def gen_cdash(c, rinv, q):
	cdash = []
	for ci in c:
		cdash.append((ci * rinv) % q)
	return cdash

def decrypt(w, cdash, n):
	message = []
	for s in cdash:
		S = 0
		for i in range(n-1, -1, -1):
			if s >= w[i]:
				s = s - w[i]
				S = S | (1 << (n - 1 - i))
		message.append(S)
	return message

# 公開鍵: beta
# 秘密鍵: w, q, r(分かってない)
# 問題文どおりに実装するとこれが得られる
w = [1, 2, 4, 8, 16, 32, 64, 128]
q = 257
# n: 8ビットの平文を暗号化する
n = 8

c = [538, 619, 944, 831, 360, 531, 468, 971, 635, 593, 655, 425, 1068, 530, 1068, 360, 706, 1068, 299, 619, 670, 1068, 891, 425, 670, 1068, 371, 670, 732, 531, 1068, 484, 372, 635, 371, 372, 237, 237, 1007]

# rの候補を全て試す
for r in range(1, q):
    rinv = pow(r, -1, q)
    cdash = gen_cdash(c, rinv, q)
    message = decrypt(w, cdash, n)
    # 得られた文字列のうち，asciiで読み取れるものを出力する
    if all([0x00 <= m <= 0x7f for m in message]):
		print(''.join([chr(m) for m in message]))
````
得られた平文をasciiで変換すると，flagが得られました．

````
ironCTF{M4th_&_C5_ar3_7h3_b3sT_c0Mb0!!}
````